language: python
install: skip

sudo: required

#branches:
#  only:
#    - master

services:
  - docker
env:
  global:
    - REGISTRY_USER=compsuperscalar
    - secure: ""

before_script:
    - docker build --pull --cache-from bscwdc/dislib --tag bscwdc/dislib .
    - docker run -d --name dislib bscwdc/dislib 
       
script: "docker exec dislib bash run_tests.sh"
script: "docker exec dislib bash run_coverage.sh"

after_success:
  - docker exec dislib codecov
after_script:
  - docker images

before_deploy:
  - docker login -u "$REGISTRY_USER" -p "$REGISTRY_PASS"
deploy:
  provider: script
  script: docker push bscwdc/dislib
  on:
    branch: master


